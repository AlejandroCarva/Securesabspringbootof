<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainA}">
<head>
    <title layout:fragment="title">Radicar Justificación</title>
</head>

<body>
<div layout:fragment="content">
    <section id="radicar-justificacion-section" class="content-section active-section" aria-labelledby="radicar-justificacion-heading">

        <div class="section-header">
            <div>
                <h2 id="radicar-justificacion-heading">Radicar Solicitud</h2>
                <p class="section-subtitle">Completa el formulario y adjunta tu evidencia</p>
            </div>
        </div>

        <!-- Mensajes flash -->
        <div th:if="${mensaje}"
             th:classappend="${tipoMensaje == 'success'} ? 'alert alert-success' : 'alert alert-danger'"
             th:text="${mensaje}">
        </div>

        <form id="formRadicarJustificacion"
              th:action="@{/aprendiz/guardar-justificacion}"
              method="POST" enctype="multipart/form-data"
              th:object="${justificacion}"
              class="form-card">

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <!-- Errores -->
            <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger">
                <ul>
                    <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                </ul>
            </div>

            <div class="filters-grid">
                <div class="form-group">
                    <label for="documentoIdentidad">Documento</label>
                    <input type="text" id="documentoIdentidad" th:value="${usuario.cedula}" readonly>
                </div>

                <div class="form-group">
                    <label for="fechaSolicitud">Fecha de solicitud</label>
                    <input type="date" id="fechaSolicitud" th:field="*{fechaSolicitud}" required>
                </div>

                <div class="form-group">
                    <label for="fechaInasistencia">Fecha de inasistencia</label>
                    <input type="date" id="fechaInasistencia" th:field="*{fechaInasistencia}" required>
                </div>
            </div>

            <div class="form-group">
                <label for="descripcionSolicitud">Motivo</label>
                <select id="descripcionSolicitud" th:field="*{descripcionSolicitud}" required>
                    <option value="">Seleccione un motivo</option>
                    <option value="Cita Médica">Cita Médica</option>
                    <option value="Entrevista Laboral">Entrevista Laboral</option>
                    <option value="Diligencia Personal">Diligencia Personal</option>
                    <option value="Fuerza Mayor">Fuerza Mayor</option>
                    <option value="Otras">Otras (especifique)</option>
                </select>
            </div>

            <div class="form-group" id="otrasJustificacionesGroup" style="display:none;">
                <label for="otrasJustificaciones">Especifique</label>
                <textarea id="otrasJustificaciones" th:field="*{otrasJustificaciones}" rows="4"
                          placeholder="Describa detalladamente su justificación..."></textarea>
            </div>

            <div class="form-group">
                <label for="competencias">Competencia</label>
                <select id="competencias" name="competencias" multiple="multiple" required>
                    <option value="">Seleccione una o más competencias</option>
                    <th:block th:if="${competencias != null and not competencias.empty}">
                        <option th:each="competencia : ${competencias}"
                                th:value="${competencia.nombreCompetencia}"
                                th:text="${competencia.nombreCompetencia}">
                        </option>
                    </th:block>
                    <th:block th:if="${competencias == null or competencias.empty}">
                        <option value="Base De Datos">Base De Datos</option>
                        <option value="Ingeneria I">Ingeneria I</option>
                        <option value="Arquitectura I">Arquitectura I</option>
                        <option value="Algoritmos I">Algoritmos I</option>
                    </th:block>
                </select>
                <small class="muted">Mantén presionada Ctrl para seleccionar múltiples opciones</small>
            </div>

            <div class="form-group">
                <label for="evidencia">Evidencia</label>
                <input type="file" id="evidencia" name="evidencia"
                       accept=".pdf,.doc,.docx,.jpg,.png" required>
                <small class="muted">Formatos: PDF, DOC, DOCX, JPG, PNG.</small>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-modern btn-primary">Enviar solicitud</button>
                <a th:href="@{/aprendiz/estado-justificaciones}" class="btn btn-modern btn-outline">Ver estado</a>
            </div>
        </form>

        <script>
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    const motivo = document.getElementById('descripcionSolicitud');
                    const group = document.getElementById('otrasJustificacionesGroup');

                    function toggle(){
                        if(!motivo || !group) return;
                        group.style.display = (motivo.value === 'Otras') ? 'block' : 'none';
                    }
                    if(motivo){
                        motivo.addEventListener('change', toggle);
                        toggle();
                    }
                });
            })();
        </script>

    </section>
</div>
</body>
</html>
